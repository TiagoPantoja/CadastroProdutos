<div class="container">
  <div class="card">
    <div class="card-header">
      <div class="d-flex justify-content-between align-items-center">
        <h1>Gerenciamento de Produtos</h1>
        <div>
          <button class="btn btn-secondary btn-sm" (click)="refreshProducts()">
            üîÑ Atualizar
          </button>
          <button class="btn btn-primary" (click)="openCreateModal()">
            ‚ûï Novo Produto
          </button>
        </div>
      </div>
    </div>
  </div>

  <div *ngIf="loading" class="loading">
    <p>Carregando...</p>
  </div>

  <div *ngIf="error && !loading" class="error-message">
    <p>{{ error }}</p>
    <button class="btn btn-primary" (click)="loadProducts()">Tentar Novamente</button>
  </div>

  <div *ngIf="!loading && !error" class="card">
    <div class="card-header">
      <h3>Produtos Cadastrados ({{ products.length }})</h3>
    </div>
    <div class="card-body">
      <div *ngIf="products.length === 0" class="text-center">
        <p>Nenhum produto encontrado.</p>
        <button class="btn btn-primary" (click)="openCreateModal()">
          Cadastrar Primeiro Produto
        </button>
      </div>

      <table *ngIf="products.length > 0" class="table">
        <thead>
        <tr>
          <th>C√≥digo</th>
          <th>Descri√ß√£o</th>
          <th>Departamento</th>
          <th>Pre√ßo</th>
          <th>Status</th>
          <th>A√ß√µes</th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let product of products">
          <td><strong>{{ product.codigo }}</strong></td>
          <td>{{ product.descricao }}</td>
          <td>{{ getDepartmentName(product.departamento) }}</td>
          <td><strong>{{ formatPrice(product.preco) }}</strong></td>
          <td>
              <span class="badge" [class]="product.status ? 'badge-success' : 'badge-danger'">
                {{ product.status ? 'Ativo' : 'Inativo' }}
              </span>
          </td>
          <td>
            <button class="btn btn-secondary btn-sm" (click)="openEditModal(product)">
              ‚úèÔ∏è Editar
            </button>
            <button class="btn btn-danger btn-sm" (click)="openDeleteConfirm(product)">
              üóëÔ∏è Excluir
            </button>
          </td>
        </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- Modal de Produto -->
<div *ngIf="showModal" class="modal-overlay" (click)="closeModal()">
  <div class="modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3 class="modal-title">{{ modalTitle }}</h3>
      <button class="modal-close" (click)="closeModal()">&times;</button>
    </div>

    <div class="modal-body">
      <form (ngSubmit)="saveProduct()">
        <div class="form-group">
          <label class="form-label">C√≥digo *</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="formData.codigo"
            name="codigo"
            placeholder="Digite o c√≥digo do produto"
            [class.error]="formErrors.codigo">
          <div *ngIf="formErrors.codigo" class="form-error">
            {{ formErrors.codigo }}
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">Descri√ß√£o *</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="formData.descricao"
            name="descricao"
            placeholder="Digite a descri√ß√£o do produto"
            [class.error]="formErrors.descricao">
          <div *ngIf="formErrors.descricao" class="form-error">
            {{ formErrors.descricao }}
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">Departamento *</label>
          <select
            class="form-control"
            [(ngModel)]="formData.departamento"
            name="departamento"
            [class.error]="formErrors.departamento">
            <option value="">Selecione um departamento</option>
            <option *ngFor="let dept of departments" [value]="dept.codigo">
              {{ dept.codigo }} - {{ dept.descricao }}
            </option>
          </select>
          <div *ngIf="formErrors.departamento" class="form-error">
            {{ formErrors.departamento }}
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">Pre√ßo *</label>
          <input
            type="number"
            step="0.01"
            min="0"
            class="form-control"
            [(ngModel)]="formData.preco"
            name="preco"
            placeholder="0,00"
            [class.error]="formErrors.preco">
          <div *ngIf="formErrors.preco" class="form-error">
            {{ formErrors.preco }}
          </div>
        </div>

        <div class="form-group">
          <label>
            <input
              type="checkbox"
              [(ngModel)]="formData.status"
              name="status">
            Produto Ativo
          </label>
        </div>
      </form>
    </div>

    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeModal()">
        Cancelar
      </button>
      <button class="btn btn-primary" (click)="saveProduct()" [disabled]="loading">
        {{ loading ? 'Salvando...' : (isEditMode ? 'Atualizar' : 'Criar') }}
      </button>
    </div>
  </div>
</div>

<div *ngIf="showDeleteConfirm" class="modal-overlay" (click)="closeDeleteConfirm()">
  <div class="modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3 class="modal-title">Confirmar Exclus√£o</h3>
      <button class="modal-close" (click)="closeDeleteConfirm()">&times;</button>
    </div>

    <div class="modal-body">
      <p>Tem certeza que deseja excluir o produto:</p>
      <p><strong>{{ productToDelete?.codigo }} - {{ productToDelete?.descricao }}</strong></p>
      <p>Esta a√ß√£o n√£o pode ser desfeita.</p>
    </div>

    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeDeleteConfirm()">
        Cancelar
      </button>
      <button class="btn btn-danger" (click)="confirmDelete()" [disabled]="loading">
        {{ loading ? 'Excluindo...' : 'Excluir' }}
      </button>
    </div>
  </div>
</div>
